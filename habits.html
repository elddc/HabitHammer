<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Habit Hammer</title>
	<link rel="icon" href="icon.png">
	<link rel="stylesheet" href="styles.css"/>
</head>
<body>
<div class="container">
	<div class="nav grid-head">
		<a class="center-verti huge" onclick="window.location.href='index.html'">
			<img src="icon.png" class="logo" alt="logo">
			Habit Hammer
		</a>
		<span>
			<button class="txt-button right white" onclick="logOut()">Log out</button>
		</span>
	</div>
    <nav class="grid-side big white">
        <ul>
            <!-- TODO pages + links -->
            <li><a href="">Today</a></li><!-- Today/Upcoming/To Do -->
            <li><a href="/">All</a></li>
            <li class="spacer"></li>
            <li><a href="">New</a></li>
            <li><a href="">+ Build</a></li>
            <li><a href="">+ Break</a></li>
            <li class="spacer"></li>
            <li><a href="">History</a></li><!-- History/Stats -->
        </ul>
    </nav>
	<div class="grid-main">
		<h1>Today</h1>
		<ul id="today">
		</ul>
	</div>

	<div class="modal-bg" id="popup">
		<div class="modal" id="modal">
			Info
		</div>
	</div>
</div>

<!-- Firebase -->

<script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-firestore.js"></script>

<script>
	const firebaseConfig = {
		apiKey: "AIzaSyBGhVi2ZSQAs3reI07GfNolcSvWO_tSEW4",
		authDomain: "ec-ftest.firebaseapp.com",
		projectId: "ec-ftest",
		storageBucket: "ec-ftest.appspot.com",
		messagingSenderId: "28831555118",
		appId: "1:28831555118:web:4a651dafec45d4a5b609bf"
	};
	firebase.initializeApp(firebaseConfig);
</script>

<script src="auth.js"></script>
<script src="habits.js"></script>

<!-- Mustache templates -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/4.1.0/mustache.min.js"></script>

<script id="taskTemplate" type="text/x-handlebars-template">
	<li><div class="habit" id={{name}} onclick="showInfo('{{name}}')">
		<button class="circle-button" onclick="doHabit(event)"></button>
		{{name}}
	</div></li>
</script>

<script id="modalTemplate" type="text/x-handlebars-template">
	<b class="big blue">{{type}}</b>
	<br><br>
	{{cue}}
	<br>
	{{routine}}
	<br>
	{{reward}}
	<br>
	{{stack}}
	<br>
	{{steps}}
</script>

<!-- Rendering Stuff -->

<script>
	const taskView = document.getElementById('taskTemplate').innerHTML;
	const modalView = document.getElementById('modalTemplate').innerHTML;

	window.onclick = function(event) {
		if (event.target === document.getElementById('popup')) {
			document.getElementById('popup').style.display = 'none';
		}
	}

	function start(user){
		setUser(user);
		displayHabit('floss');
		//fillExample();
	}

	function displayHabit(name){
		document.getElementById('today').innerHTML = Mustache.render(taskView, {name});
	}

	async function showInfo(name){
		let habit = await getHabit(name);
		console.log(habit);

		document.getElementById('modal').innerHTML = Mustache.render(modalView, habit);
		document.getElementById('popup').style.display='grid';
	}

	function doHabit(ev){
		ev.stopPropagation();
	}
</script>
</body>
</html>
